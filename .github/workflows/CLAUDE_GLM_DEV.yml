name: CLAUDE_CODE_GLM_DEV

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

permissions:
  contents: write
  pull-requests: write
  issues: write
  id-token: write

jobs:
  CLAUDE:
    runs-on: ubuntu-latest

    # ついでに bot 自己トリガーを防ぐ（推奨）
    if: github.actor != 'claude[bot]'

    steps:
      - uses: actions/checkout@v4

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ZAI_API_KEY }}
        env:
          ANTHROPIC_BASE_URL: ${{ vars.ANTHROPIC_BASE_URL || 'https://api.z.ai/api/anthropic' }}
          ANTHROPIC_AUTH_TOKEN: ${{ secrets.ZAI_API_KEY }}

          API_TIMEOUT_MS: ${{ vars.API_TIMEOUT_MS || '3000000' }}
          ANTHROPIC_DEFAULT_OPUS_MODEL: ${{ vars.ANTHROPIC_DEFAULT_OPUS_MODEL || 'glm-4.7' }}
          ANTHROPIC_DEFAULT_SONNET_MODEL: ${{ vars.ANTHROPIC_DEFAULT_SONNET_MODEL || 'glm-4.7' }}
          ANTHROPIC_DEFAULT_HAIKU_MODEL: ${{ vars.ANTHROPIC_DEFAULT_HAIKU_MODEL || 'glm-4.5-air' }}
